# GNN MP model
**This repository is under development.**

Final results were presented at the PTChem2024 scientific conference in mid-September. 

## Overview

This is a Kedro project with Kedro-Viz setup and kedro-mlflow plugin for tracking purposes, generated using `kedro 0.19.6`.
These repositories are part of a doctoral thesis aimed at creating models to predict the properties of ionic liquids using graph-level prediction (graph neural networks). These specific focuses predict the melting point. 

The neural network used uses state-of-the-art GNNs, including (GPS) Graph Transformer layers [https://arxiv.org/abs/2205.12454], Adaptive Readout layers [https://arxiv.org/abs/2211.04952], Hierarchical GNNs Architecture [https://arxiv.org/abs/1811.01287] and Graph Normalization Layers [https://arxiv.org/abs/2009.03294].

The source code for the GNN pipeline can be found in src/gnn_mp_model/pipelines. The main model code can be found in src/gnn_mp_model/pipelines/data_science/nodes.py. 


## Dataset
Data from two sources were used for modelling: publications by Makarov et al.  and the ILThermo database from 2017-2023. After integration, removal of duplicates and standardization of melting temperatures (Tm), a set containing 3283 points was obtained. Due to the lack of convergence in the model for high and low temperatures, the data was reduced by discarding results for temperatures above 250 °C and below 0 °C. This restriction reduced the database to 2572 points, more than 78% of the original set, comprising 1606 different cations (62% of which occur only once) and 206 anions (8% of which occur only once). 
![image](https://github.com/user-attachments/assets/61394ab6-5b6b-4ac7-bb86-b71100bae104)


The following features, produced with RDKit, were used to describe the graphs:


![image](https://github.com/user-attachments/assets/2a0f8918-dc57-4035-a7c0-0af13f5408a5)

## Model structure:
The PyTorch Geometric library was used to model graphs in the Python environment. Graph Convolution is a basic operation in graph neural networks, equivalent to classical convolution in standard neural networks, but adapted to graph data. In this research, we used the GPS layer. The two-layer structure of the network is shown - ultimately, a five-layer structure was used.


![image](https://github.com/user-attachments/assets/b7350890-af30-47d7-99ec-c86f16a67f3e)

## Results
In order to evaluate the impact of different model configurations, four variants were compared, which differed only in the application of graph reduction operations (graph pooling) and the attachment of global features to the final graph representation. The full version of the model (labelled pool_gf) consisted of five GraphConv, GraphNorm and GraphConv blocks, after which a four-layer classical neural network calculated the result based on the graph representation.  From the analysis of the results, it can be concluded that the use of additional layers and global features did not increase the accuracy of the model. Moreover, the model trained on the full dataset, without graph reduction operations and attached global features (denoted as full_no_pool_no_gf), achieved the best results on the test set, while avoiding overtraining.


![image](https://github.com/user-attachments/assets/9700a15d-45b1-4e86-a733-efdd2cc86760)

## Model interpretation
To analyze and understand the performance of the model, the GNNExplainer algorithm was used to evaluate the influence of individual atoms, bonds and atomic descriptors on the predictions generated by the model. The interpretation of the results was carried out for two ionic liquids, namely 1-ethyl-3-methylimidazolium tetrafluoroborate and 1-propylpyridinium bromide, and is shown in Figure a-d below. A and c illustrate the structures of the ionic liquids with atoms and bonds color-coded, where the intensity of the color indicates the strength of the element's influence on the model result. 

![image](https://github.com/user-attachments/assets/63c74638-7f07-4012-82d1-a54547c5a90d)



## Project pipeline generated with kedro-viz:
![kedro-pipeline (3)](https://github.com/user-attachments/assets/1bbdef6a-9962-4e9f-9b7f-e972c0da34f6)



